task buildIDL {


    doLast {
        // IDL出力先生成
        File cppOutDir = new File("./gen-cpp").getAbsoluteFile();
        cppOutDir.mkdirs();

        File javaOutDir = new File("./gen-java").getAbsoluteFile();
        javaOutDir.mkdirs();

        File srcDir = new File("./idl/").getAbsoluteFile();

        for(File proto : srcDir.listFiles()) {
            if(proto.getName().endsWith(".proto")) {
                // IDL File
                // build
                println("compile :: " + proto.getName());
                ant.exec(executable : 'protoc', dir : ".", output : "protoc.log") {
                    arg(value:String.format("--proto_path=%s", proto.parentFile.absolutePath));
                    arg(value:"--cpp_out");
                    arg(value:cppOutDir.absolutePath);
                    arg(value:"--java_out");
                    arg(value:javaOutDir.absolutePath);
                    arg(value:proto.absolutePath);
                }
            }
        }
    }
}
